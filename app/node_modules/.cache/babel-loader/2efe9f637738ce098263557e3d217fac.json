{"ast":null,"code":"// Context\nimport { context } from './context';\nimport { openOverlay, closeOverlay, updateOverlay, removeOverlay } from './overlay'; // Utils\n\nimport { on, off, preventDefault } from '../../utils/dom/event';\nimport { removeNode } from '../../utils/dom/node';\nimport { getScroller } from '../../utils/dom/scroll'; // Mixins\n\nimport { TouchMixin } from '../touch';\nimport { PortalMixin } from '../portal';\nimport { CloseOnPopstateMixin } from '../close-on-popstate';\nexport var popupMixinProps = {\n  // Initial rendering animation\n  transitionAppear: Boolean,\n  // whether to show popup\n  value: Boolean,\n  // whether to show overlay\n  overlay: Boolean,\n  // overlay custom style\n  overlayStyle: Object,\n  // overlay custom class name\n  overlayClass: String,\n  // whether to close popup when overlay is clicked\n  closeOnClickOverlay: Boolean,\n  // z-index\n  zIndex: [Number, String],\n  // prevent body scroll\n  lockScroll: {\n    type: Boolean,\n    default: true\n  },\n  // whether to lazy render\n  lazyRender: {\n    type: Boolean,\n    default: true\n  }\n};\nexport function PopupMixin(options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return {\n    mixins: [TouchMixin, CloseOnPopstateMixin, PortalMixin({\n      afterPortal: function afterPortal() {\n        if (this.overlay) {\n          updateOverlay();\n        }\n      }\n    })],\n    provide: function provide() {\n      return {\n        vanPopup: this\n      };\n    },\n    props: popupMixinProps,\n    data: function data() {\n      this.onReopenCallback = [];\n      return {\n        inited: this.value\n      };\n    },\n    computed: {\n      shouldRender: function shouldRender() {\n        return this.inited || !this.lazyRender;\n      }\n    },\n    watch: {\n      value: function value(val) {\n        var type = val ? 'open' : 'close';\n        this.inited = this.inited || this.value;\n        this[type]();\n\n        if (!options.skipToggleEvent) {\n          this.$emit(type);\n        }\n      },\n      overlay: 'renderOverlay'\n    },\n    mounted: function mounted() {\n      if (this.value) {\n        this.open();\n      }\n    },\n\n    /* istanbul ignore next */\n    activated: function activated() {\n      if (this.shouldReopen) {\n        this.$emit('input', true);\n        this.shouldReopen = false;\n      }\n    },\n    beforeDestroy: function beforeDestroy() {\n      removeOverlay(this);\n\n      if (this.opened) {\n        this.removeLock();\n      }\n\n      if (this.getContainer) {\n        removeNode(this.$el);\n      }\n    },\n\n    /* istanbul ignore next */\n    deactivated: function deactivated() {\n      if (this.value) {\n        this.close();\n        this.shouldReopen = true;\n      }\n    },\n    methods: {\n      open: function open() {\n        /* istanbul ignore next */\n        if (this.$isServer || this.opened) {\n          return;\n        } // cover default zIndex\n\n\n        if (this.zIndex !== undefined) {\n          context.zIndex = this.zIndex;\n        }\n\n        this.opened = true;\n        this.renderOverlay();\n        this.addLock();\n        this.onReopenCallback.forEach(function (callback) {\n          callback();\n        });\n      },\n      addLock: function addLock() {\n        if (this.lockScroll) {\n          on(document, 'touchstart', this.touchStart);\n          on(document, 'touchmove', this.onTouchMove);\n\n          if (!context.lockCount) {\n            document.body.classList.add('van-overflow-hidden');\n          }\n\n          context.lockCount++;\n        }\n      },\n      removeLock: function removeLock() {\n        if (this.lockScroll && context.lockCount) {\n          context.lockCount--;\n          off(document, 'touchstart', this.touchStart);\n          off(document, 'touchmove', this.onTouchMove);\n\n          if (!context.lockCount) {\n            document.body.classList.remove('van-overflow-hidden');\n          }\n        }\n      },\n      close: function close() {\n        if (!this.opened) {\n          return;\n        }\n\n        closeOverlay(this);\n        this.opened = false;\n        this.removeLock();\n        this.$emit('input', false);\n      },\n      onTouchMove: function onTouchMove(event) {\n        this.touchMove(event);\n        var direction = this.deltaY > 0 ? '10' : '01';\n        var el = getScroller(event.target, this.$el);\n        var scrollHeight = el.scrollHeight,\n            offsetHeight = el.offsetHeight,\n            scrollTop = el.scrollTop;\n        var status = '11';\n        /* istanbul ignore next */\n\n        if (scrollTop === 0) {\n          status = offsetHeight >= scrollHeight ? '00' : '01';\n        } else if (scrollTop + offsetHeight >= scrollHeight) {\n          status = '10';\n        }\n        /* istanbul ignore next */\n\n\n        if (status !== '11' && this.direction === 'vertical' && !(parseInt(status, 2) & parseInt(direction, 2))) {\n          preventDefault(event, true);\n        }\n      },\n      renderOverlay: function renderOverlay() {\n        var _this = this;\n\n        if (this.$isServer || !this.value) {\n          return;\n        }\n\n        this.$nextTick(function () {\n          _this.updateZIndex(_this.overlay ? 1 : 0);\n\n          if (_this.overlay) {\n            openOverlay(_this, {\n              zIndex: context.zIndex++,\n              duration: _this.duration,\n              className: _this.overlayClass,\n              customStyle: _this.overlayStyle\n            });\n          } else {\n            closeOverlay(_this);\n          }\n        });\n      },\n      updateZIndex: function updateZIndex(value) {\n        if (value === void 0) {\n          value = 0;\n        }\n\n        this.$el.style.zIndex = ++context.zIndex + value;\n      },\n      onReopen: function onReopen(callback) {\n        this.onReopenCallback.push(callback);\n      }\n    }\n  };\n}","map":{"version":3,"names":["context","openOverlay","closeOverlay","updateOverlay","removeOverlay","on","off","preventDefault","removeNode","getScroller","TouchMixin","PortalMixin","CloseOnPopstateMixin","popupMixinProps","transitionAppear","Boolean","value","overlay","overlayStyle","Object","overlayClass","String","closeOnClickOverlay","zIndex","Number","lockScroll","type","default","lazyRender","PopupMixin","options","mixins","afterPortal","provide","vanPopup","props","data","onReopenCallback","inited","computed","shouldRender","watch","val","skipToggleEvent","$emit","mounted","open","activated","shouldReopen","beforeDestroy","opened","removeLock","getContainer","$el","deactivated","close","methods","$isServer","undefined","renderOverlay","addLock","forEach","callback","document","touchStart","onTouchMove","lockCount","body","classList","add","remove","event","touchMove","direction","deltaY","el","target","scrollHeight","offsetHeight","scrollTop","status","parseInt","_this","$nextTick","updateZIndex","duration","className","customStyle","style","onReopen","push"],"sources":["E:/HTML_studying/项目/vue-vant项目-谁是卧底/app/node_modules/vant/es/mixins/popup/index.js"],"sourcesContent":["// Context\nimport { context } from './context';\nimport { openOverlay, closeOverlay, updateOverlay, removeOverlay } from './overlay'; // Utils\n\nimport { on, off, preventDefault } from '../../utils/dom/event';\nimport { removeNode } from '../../utils/dom/node';\nimport { getScroller } from '../../utils/dom/scroll'; // Mixins\n\nimport { TouchMixin } from '../touch';\nimport { PortalMixin } from '../portal';\nimport { CloseOnPopstateMixin } from '../close-on-popstate';\nexport var popupMixinProps = {\n  // Initial rendering animation\n  transitionAppear: Boolean,\n  // whether to show popup\n  value: Boolean,\n  // whether to show overlay\n  overlay: Boolean,\n  // overlay custom style\n  overlayStyle: Object,\n  // overlay custom class name\n  overlayClass: String,\n  // whether to close popup when overlay is clicked\n  closeOnClickOverlay: Boolean,\n  // z-index\n  zIndex: [Number, String],\n  // prevent body scroll\n  lockScroll: {\n    type: Boolean,\n    default: true\n  },\n  // whether to lazy render\n  lazyRender: {\n    type: Boolean,\n    default: true\n  }\n};\nexport function PopupMixin(options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return {\n    mixins: [TouchMixin, CloseOnPopstateMixin, PortalMixin({\n      afterPortal: function afterPortal() {\n        if (this.overlay) {\n          updateOverlay();\n        }\n      }\n    })],\n    provide: function provide() {\n      return {\n        vanPopup: this\n      };\n    },\n    props: popupMixinProps,\n    data: function data() {\n      this.onReopenCallback = [];\n      return {\n        inited: this.value\n      };\n    },\n    computed: {\n      shouldRender: function shouldRender() {\n        return this.inited || !this.lazyRender;\n      }\n    },\n    watch: {\n      value: function value(val) {\n        var type = val ? 'open' : 'close';\n        this.inited = this.inited || this.value;\n        this[type]();\n\n        if (!options.skipToggleEvent) {\n          this.$emit(type);\n        }\n      },\n      overlay: 'renderOverlay'\n    },\n    mounted: function mounted() {\n      if (this.value) {\n        this.open();\n      }\n    },\n\n    /* istanbul ignore next */\n    activated: function activated() {\n      if (this.shouldReopen) {\n        this.$emit('input', true);\n        this.shouldReopen = false;\n      }\n    },\n    beforeDestroy: function beforeDestroy() {\n      removeOverlay(this);\n\n      if (this.opened) {\n        this.removeLock();\n      }\n\n      if (this.getContainer) {\n        removeNode(this.$el);\n      }\n    },\n\n    /* istanbul ignore next */\n    deactivated: function deactivated() {\n      if (this.value) {\n        this.close();\n        this.shouldReopen = true;\n      }\n    },\n    methods: {\n      open: function open() {\n        /* istanbul ignore next */\n        if (this.$isServer || this.opened) {\n          return;\n        } // cover default zIndex\n\n\n        if (this.zIndex !== undefined) {\n          context.zIndex = this.zIndex;\n        }\n\n        this.opened = true;\n        this.renderOverlay();\n        this.addLock();\n        this.onReopenCallback.forEach(function (callback) {\n          callback();\n        });\n      },\n      addLock: function addLock() {\n        if (this.lockScroll) {\n          on(document, 'touchstart', this.touchStart);\n          on(document, 'touchmove', this.onTouchMove);\n\n          if (!context.lockCount) {\n            document.body.classList.add('van-overflow-hidden');\n          }\n\n          context.lockCount++;\n        }\n      },\n      removeLock: function removeLock() {\n        if (this.lockScroll && context.lockCount) {\n          context.lockCount--;\n          off(document, 'touchstart', this.touchStart);\n          off(document, 'touchmove', this.onTouchMove);\n\n          if (!context.lockCount) {\n            document.body.classList.remove('van-overflow-hidden');\n          }\n        }\n      },\n      close: function close() {\n        if (!this.opened) {\n          return;\n        }\n\n        closeOverlay(this);\n        this.opened = false;\n        this.removeLock();\n        this.$emit('input', false);\n      },\n      onTouchMove: function onTouchMove(event) {\n        this.touchMove(event);\n        var direction = this.deltaY > 0 ? '10' : '01';\n        var el = getScroller(event.target, this.$el);\n        var scrollHeight = el.scrollHeight,\n            offsetHeight = el.offsetHeight,\n            scrollTop = el.scrollTop;\n        var status = '11';\n        /* istanbul ignore next */\n\n        if (scrollTop === 0) {\n          status = offsetHeight >= scrollHeight ? '00' : '01';\n        } else if (scrollTop + offsetHeight >= scrollHeight) {\n          status = '10';\n        }\n        /* istanbul ignore next */\n\n\n        if (status !== '11' && this.direction === 'vertical' && !(parseInt(status, 2) & parseInt(direction, 2))) {\n          preventDefault(event, true);\n        }\n      },\n      renderOverlay: function renderOverlay() {\n        var _this = this;\n\n        if (this.$isServer || !this.value) {\n          return;\n        }\n\n        this.$nextTick(function () {\n          _this.updateZIndex(_this.overlay ? 1 : 0);\n\n          if (_this.overlay) {\n            openOverlay(_this, {\n              zIndex: context.zIndex++,\n              duration: _this.duration,\n              className: _this.overlayClass,\n              customStyle: _this.overlayStyle\n            });\n          } else {\n            closeOverlay(_this);\n          }\n        });\n      },\n      updateZIndex: function updateZIndex(value) {\n        if (value === void 0) {\n          value = 0;\n        }\n\n        this.$el.style.zIndex = ++context.zIndex + value;\n      },\n      onReopen: function onReopen(callback) {\n        this.onReopenCallback.push(callback);\n      }\n    }\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}